{extend name="index"} {block name="title"}文章编辑{/block} {block name="content"}
<!-- <script type="text/javascript" src="{:__ROOT__}/style/js/Calculation.js"></script> | 此处不再需要计算总价-->
<!-- 报价逻辑 -->
<script type="text/javascript" src="{:__ROOT__}/style/js/quoteService.js"></script>
<div class="col-md-8 col-md-offset-1" style="margin-top: 10px;min-height: 730px;">
    <a class="btn btn-primary" style="margin-bottom: 20px;" href="{:url('article/index')}"><i
            class="glyphicon glyphicon-arrow-left"></i>&nbsp;返回</a>
    <h2><span class="glyphicon glyphicon-edit"></span>&nbsp;文章编辑</h2>
    <br>
    <form method="post" action="{:url ('addsecond',['articleId'=>$articleId])}" enctype="multipart/form-data"
          onsubmit="setDisabledBtn()">
        <div class="form-group">
            <label for="TitleInput">标题</label>
            <input type="text" class="form-control" id="TitleInput" placeholder="标题" name="title" value="{$title}">
        </div>
        <div class="form-group">
            <label>摘要</label>
            <!-- 加载编辑器的容器 -->
            <script id="container" name="summery" type="text/plain">
                    {$summery}

            </script>
            <!-- 配置文件 -->
            <script type="text/javascript" src="{:__ROOT__}/style/js/paragraphController/ueditor.config.js"></script>
            <script type="text/javascript" src="{:__ROOT__}/style/js/paragraphController/ueditor.all.js"></script>
            <!-- 实例化编辑器 -->
            <script type="text/javascript">
                var ue = UE.getEditor('container', {
                    toolbars: [
                        ['fullscreen', 'source', 'undo', 'redo', 'bold', 'indent', 'fontsize', 'paragraph', 'italic', 'underline', 'strikethrough', 'superscript', 'subscript', 'touppercase', 'tolowercase', 'justifyleft', 'justifyright', 'justifycenter', 'justifyjustify']
                    ],
                    autoHeightEnabled: true,
                    autoFloatEnabled: true
                });
            </script>
        </div>
        <div class="form-group">
            <label>出发日期</label>
            <input type="date" class="form-control" name="begin_date" value="{$article->begin_date}" required>
        </div>
        <div class="form-group">
            <label>封面</label>
            <img src="{:__ROOT__}/upload/{$cover}"
                 style="width: auto; height: auto; max-width: 280px; max-height: 158px;" alt="无图">
            <br>
            <br>
            <a class="btn btn-default" href="{:url('editfirstadd?articleId=' . $articleId)}"><span
                    class="glyphicon glyphicon-pencil"></span>&nbsp;更改文章及定制师</a>
        </div>
        <div class="form-group">
            <label>正文</label>
            <span class="col-md-offset-1"></span>
            <a class="btn btn-primary btn-sm" href="{:url('Paragraph/index', ['articleId'=>$articleId,'id'=>''])}"><span
                    class="glyphicon glyphicon-plus"></span>&nbsp;自定义段落</a>
        </div>
        <ul style="list-style-type: none;">
            {volist name="paragraphUp" id="paragraph"}
            <li>
                <div class="panel panel-default">
                    <div class="panel-body">
                        <h4>{$paragraph->title}</h4>
                        <div class="row">
                            <div class="col-md-3" style="height: auto;">
                                <img src="{:__ROOT__}/upload/{$paragraph->image}"
                                     style="width: auto; height: auto; max-width: 250px; max-height: 140px;" alt="">
                            </div>
                            <div class="col-md-6 col-md-offset-1" style="word-wrap: break-word;">
                                {$filter->limitWordNumber($paragraph->content, 245)}
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12" style="height: 40px; margin-top: 10px;">
                                <a class="btn btn-info btn-sm"
                                   href="{:url('Paragraph/edit',['articleId'=>$articleId,'id'=>$paragraph->id])}"><span
                                        class="glyphicon glyphicon-pencil"></span>&nbsp;编辑</a>
                                <a class="btn btn-danger btn-sm"
                                   href="{:url('Paragraph/delete', ['articleId'=>$articleId,'id'=>$paragraph->id])}"><span
                                        class="glyphicon glyphicon-trash"></span>&nbsp;删除</a>
                            </div>
                        </div>
                    </div>
                </div>
            </li>
            {/volist} {volist name="attraction" id="_attraction" key="keys"}
            <li>
                <div class="panel panel-default">
                    <div class="panel-body">
                        <h4>Day{$keys}</h4>
                        <br>
                        <div class="row">
                            <div class="col-md-5">
                                总行程：{$_attraction->trip}<br>
                                日期：{$_attraction->getDateByBeginDateAndOrder($article->begin_date, $keys)}<br>
                                <!-- 导游：{$_attraction->guide}<br> -->
                                用餐：{$_attraction->getMeals()}<br>
                                用车：{$_attraction->getCars()}<br>

                                景点：{volist name="$_attraction->getCheckedMaterial()" id="material"}
                                <button type="button" class="btn btn-default btn-xs">{$material->designation}</button>
                                {/volist}
                                <br>
                                酒店：{$_attraction->getHotelDesignation()}<br>
                                描述：{$_attraction->description | $filter->limitWordNumber}<br>
                            </div>
                            <div class="col-md-5">
                                {eq name="$_attraction->image" value=""}{else /}
                                <img src="{:__ROOT__}/upload/{:json_decode($_attraction->image)}"
                                     style="width: auto;height: auto;max-width: 300px;max-height: 170px;">
                                {/eq}
                            </div>
                            <div class="col-md-2">
                                <br>
                                <br>
                                {eq name="$keys" value="1"} {else /}<a class="btn btn-default"
                                                                       href="{:url('upAttraction',['articleId'=>$articleId,'attractionId'=>$_attraction->id,'number'=>$keys])}"><span
                                    class="glyphicon glyphicon-arrow-up"></span></a>{/eq}
                                <br>
                                {eq name="$keys" value="$length"} {else /}<a class="btn btn-default"
                                                                             href="{:url('downAttraction',['articleId'=>$articleId,'attractionId'=>$_attraction->id,'number'=>$keys])}"><span
                                    class="glyphicon glyphicon-arrow-down"></span></a>{/eq}
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12" style="height: 40px; margin-top: 10px;">
                                <a class="btn btn-info btn-sm"
                                   href="{:url('attraction/edit' ,['articleId'=>$articleId,'attractionId'=>$_attraction->id] )}"><span
                                        class="glyphicon glyphicon-pencil"></span>&nbsp;编辑</a>
                                <a class="btn btn-danger btn-sm"
                                   href="{:url('attraction/delete' ,['articleId'=>$articleId,'attractionId'=>$_attraction->id] )}"><span
                                        class="glyphicon glyphicon-trash"></span>&nbsp;删除</a>
                            </div>
                        </div>
                    </div>
                </div>
            </li>
            <div class="row-fluid">

            </div>
            {/volist}
            &nbsp;&nbsp;
            <a class="btn btn-primary btn-sm" href="{:url('Attraction/add?articleId='.$articleId)}"><span
                    class="glyphicon glyphicon-plus"></span>&nbsp;日程</a>
            <div style="margin-top: 60px;">
                <div class="row">
                    <div class="col-md-12">
                        <div id="myTabContent" class="tab-content">
                            <div class="tab-pane fade in active" id="firstform">
                                <br>
                                <div class="control-group row">
                                    <label class="control-label">出行人数</label>
                                    <br><br>
                                    <div class="row">
                                        <div class="form-group col-md-3" style="background-color: ">
                                            <label>成人数</label>
                                            <input type="number" style="background-color: #fcf8e3;" class="form-control"
                                                   name="adultNum" placeholder="成人..."
                                                   value="{$plan->adult_num}" required>
                                        </div>
                                        <div class="form-group col-md-3">
                                            <label>儿童数</label>
                                            <input type="number" style="background-color: #fcf8e3;" class="form-control"
                                                   name="childNum" placeholder="儿童..."
                                                   value="{$plan->child_num}" required>
                                        </div>
                                    </div>
                                    <hr>
                                </div>
                                <div class="control-group row" id="quoteGroup">
                                    <label>报价类别</label>
                                    <br><br>
                                    {volist name="$plan->getRelevantDetails()" id="detail"}
                                    <div class="row">
                                        <div class="form-group col-md-3">
                                            <label>名称</label>
                                            <input type="text" class="form-control" value="{$detail->designation}" name="designation[]">
                                        </div>
                                        <div class="form-group col-md-3">
                                            <label>成人单价</label>
                                            <input type="text" class="form-control" value="{$detail->adult_unit_price}" name="adultUnitPrice[]">
                                        </div>
                                        <div class="form-group col-md-3">
                                            <label>儿童单价</label>
                                            <input type="text" class="form-control" value="{$detail->child_unit_price}" name="childUnitPrice[]">
                                        </div>
                                        <div class="form-group col-md-3">
                                            <label>备注</label>
                                            <input type="text" class="form-control" value="{$detail->remark}" name="remark[]">
                                        </div>
                                    </div>
                                    {/volist}
                                </div>
                                <a class="btn btn-primary" id="newQuote"><i class="glyphicon glyphicon-plus"></i></a>
                                <a class="btn btn-danger" id="removeQuote"><i class="glyphicon glyphicon-minus"></i></a>
                                <hr>
                                <div class="control-group row">
                                    <label>币种</label>
                                    <div class="controls">
                                        <input type="text" class="form-control" name="currency" placeholder="币种..."
                                               value="{$plan->currency}" 　required>
                                    </div>
                                </div>
                                <hr>
                                <div class="control-group row">
                                    <label for="totalCost">总费用</label>
                                    <div class="controls">
                                        <input readonly type="text" style="background-color: #fcf8e3;"
                                               class="form-control" id="totalCost" name="totalCost" placeholder="总费用..."
                                               value="{$plan->total_cost | $filter->moneyFilter}"/>
                                    </div>
                                </div>
                                <hr>
                                <div class="control-group row">
                                    <label>最晚付款时间</label>
                                    <div class="controls">
                                        <input type="date" class="form-control" name="lastPayTime"
                                               value="{$plan->last_pay_time}" required>
                                    </div>
                                </div>
                            </div>
                            <hr>
                        </div>
                    </div>
                </div>
            </div>
            {volist name="paragraphDown" id="paragraph"}
            <li>
                <div class="panel panel-default">
                    <div class="panel-body">
                        <h4>{$paragraph->title}</h4>
                        <div class="row">
                            <div class="col-md-3" style="height: 100px;">
                                <img src="{:__ROOT__}/upload/{$paragraph->image}" style="height: 100px; width: 180px;"
                                     alt="">
                            </div>
                            <div class="col-md-6 col-md-offset-1" style="word-wrap: break-word;">
                                {$paragraph->content | $filter->limitWordNumber}
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12" style="height: 40px; margin-top: 10px;">
                                <a class="btn btn-info btn-sm"
                                   href="{:url('Paragraph/edit',['articleId'=>$articleId,'id'=>$paragraph->id])}"><span
                                        class="glyphicon glyphicon-pencil"></span>&nbsp;编辑</a>
                                <a class="btn btn-danger btn-sm"
                                   href="{:url('Paragraph/delete', ['articleId'=>$articleId,'id'=>$paragraph->id])}"><span
                                        class="glyphicon glyphicon-trash"></span>&nbsp;删除</a>
                            </div>
                        </div>
                    </div>
                </div>
            </li>
            {/volist}
            <!-- 定制师 -->
            <li>
                <div class="panel panel-default">
                    <div class="panel-body">
                        <div class="row">
                            <div class="col-md-12">
                                <table class="table table-hover table-bordered">
                                    {eq name="$judgeContractor" value="0"} {else/}
                                    <tr>
                                        <th>定制师</th>
                                        <td>{$contractor->designation}</td>
                                    </tr>
                                    <tr>
                                        <th>微信</th>
                                        <td>{$contractor->phone}</td>
                                    </tr>
                                    <tr>
                                        <th>手机号码</th>
                                        <td>{$contractor->mobile}</td>
                                    </tr>
                                    <tr>
                                        <th>电子邮件</th>
                                        <td>{$contractor->email}</td>
                                    </tr>

                                </table>
                                <a href="{:url('contractor/edit' ,['contractorId'=>$contractor->id] )}"
                                   class="btn btn-info btn-sm">
                                    <i class="glyphicon glyphicon-pencil"></i>&nbsp;编辑
                                </a>
                                {/eq}
                            </div>
                        </div>
                    </div>
                </div>
            </li>
            <li>
                <div>
                    <table class="table table-hover table-responsive table-bordered" style="word-break:break-all;">
                        {eq name="$judgeHotel" value="0"} {else/}
                        <h3>酒店信息</h3>
                        <tr class="warning">
                            <th width="20%">名称</th>
                            <th width="20%">城市</th>
                            <th width="20%">星级</th>
                            <th width="40%">备注</th>
                        </tr>
                        {/eq} {volist name="hotel" id="hotel"}
                        <tr>
                            <th>{$hotel->designation}</th>
                            <th>{$hotel->city}</th>
                            <th>{$hotel->star_level}</th>
                            <th>{$hotel->remark}</th>
                        </tr>
                        {/volist}
                    </table>
                </div>
            </li>
        </ul>
        <script type="text/javascript" src="{:__ROOT__}/style/js/Calculation.js"></script>
        <button type="submit" id="submit-btn" class="btn btn-default"><span class="glyphicon glyphicon-ok"></span>&nbsp;完成
        </button>
        <br>
        <br>
    </form>
</div>
{/block}